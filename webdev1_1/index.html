<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
  </head>
  <body>
    <div id="app">
      <v-app>
        <v-card color="green" width="400px" class="mx-auto mt-5" v-show="show">
          <v-card-actions>
            <v-card-text v-bind:text-content.prop="disp_count_val" class="blue darken-1 white--text font-weight-bold text-h2 text-right rounded ma-5">0</v-card-text>
          </v-card-actions>
          <v-card-actions>
            <v-card-text class="d-flex justify-space-around mb-6">
              <v-btn v-on:click="increment">カウントアップ</v-btn>
              <v-btn v-on:click="reset">リセット</v-btn>
              <v-btn v-on:click="save" @click="overlay = !overlay">保存</v-btn>
            </v-card-text >
          </v-card-actions>
        </v-card>
        <v-overlay :value="overlay">
          <v-progress-circular
            indeterminate
            size="64"
          ></v-progress-circular>
        </v-overlay>
      </v-app>
    </div>
  </body>
  <script>
    const vm = new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data: {
        disp_count_val: '',
        show : false,
        overlay: false
      },
      async created () {
        //起動時にGAS側からデータを取得する
        await google.script.run.withSuccessHandler(this.initData).withFailureHandler(this.failure).getCouterTable();
      },
      methods: {
        initData (returnData) {
          this.disp_count_val = returnData;
          // カウンターの初期表示終了後に各ボタンが表示するようにする
          this.show = true;
        },
        failure (returnData) {
          alert('失敗しました');
        },
        // カウントアップボタンクリック処理
        increment () {
          this.disp_count_val += 1;
        },
        // リセットボタンクリック処理
        reset () {
          this.disp_count_val = 0;
        },
        // 保存ボタンクリック処理
        async save () {
          // 取得した値を setSheetData関数の引数として設定して呼び出します。
          await google.script.run.withSuccessHandler(function(){
            this.overlay = true;
            alert('保存しました');
          }).withFailureHandler(function(){
            this.overlay = true;
            alert('失敗しました');
          }).updCounterTable(this.disp_count_val);
        }       
      },
      watch: {
        overlay (val) {
          val && setTimeout(() => {
            this.overlay = false
          }, 1000)
        },
      },
    })
  </script>
</html>
